services:
  # API Gateway - Port 3000
  api-gateway:
    build:
      context: .
      dockerfile: ./services/api-gateway/Dockerfile
    container_name: api-gateway
    restart: unless-stopped
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - PORT=3000
      - AUTH_SERVICE_URL=http://auth-service:3001
      - USER_PROFILE_SERVICE_URL=http://user-profile-service:3002
      - STUDY_SERVICE_URL=http://study-service:3003
      - AI_ORCHESTRATOR_SERVICE_URL=http://ai-orchestrator-service:3004
      - SIGNAL_PROCESSING_SERVICE_URL=http://signal-processing-service:3005
      - ANALYTICS_SERVICE_URL=http://analytics-service:3006
    depends_on:
      - auth-service
      - user-profile-service
      - study-service
      - ai-orchestrator-service
      - signal-processing-service
      - analytics-service
      - ai-service
    networks:
      - study-partner-network

  # Auth Service - Port 3001
  auth-service:
    build:
      context: .
      dockerfile: ./services/auth/Dockerfile
    container_name: auth-service
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      - NODE_ENV=development
      - PORT=3001
      - MONGODB_URI=mongodb://host.docker.internal:27017/study_partner
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
      - JWT_EXPIRES_IN=1h
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - study-partner-network

  # User Profile Service - Port 3002
  user-profile-service:
    build:
      context: .
      dockerfile: ./services/user-profile/Dockerfile
    container_name: user-profile-service
    restart: unless-stopped
    ports:
      - "3002:3002"
    environment:
      - NODE_ENV=development
      - PORT=3002
      - MONGODB_URI=mongodb://host.docker.internal:27017/study_partner
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - study-partner-network

  # Study Management Service - Port 3003
  study-service:
    build:
      context: .
      dockerfile: ./services/study/Dockerfile
    container_name: study-service
    restart: unless-stopped
    ports:
      - "3003:3003"
    environment:
      - NODE_ENV=development
      - PORT=3003
      - MONGODB_URI=mongodb://host.docker.internal:27017/study_partner
      - AI_SERVICE_URL=http://ai-service:8000
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
    depends_on:
      - ai-service
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./services/study/src:/app/services/study/src
    networks:
      - study-partner-network

  # AI Orchestrator Service - Port 3004
  ai-orchestrator-service:
    build:
      context: .
      dockerfile: ./services/ai-orchestrator/Dockerfile
    container_name: ai-orchestrator-service
    restart: unless-stopped
    ports:
      - "3004:3004"
    environment:
      - NODE_ENV=development
      - PORT=3004
      - AI_SERVICE_URL=http://ai-service:8000
      - USER_PROFILE_SERVICE_URL=http://user-profile-service:3002
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
    depends_on:
      - ai-service
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - study-partner-network

  # Signal Processing Service - Port 3005
  signal-processing-service:
    build:
      context: .
      dockerfile: ./services/signal-processing/Dockerfile
    container_name: signal-processing-service
    restart: unless-stopped
    ports:
      - "3005:3005"
    environment:
      - NODE_ENV=development
      - PORT=3005
      - MONGODB_URI=mongodb://host.docker.internal:27017/study_partner
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - study-partner-network

  # Analytics Service - Port 3006
  analytics-service:
    build:
      context: .
      dockerfile: ./services/analytics/Dockerfile
    container_name: analytics-service
    restart: unless-stopped
    ports:
      - "3006:3006"
    environment:
      - NODE_ENV=development
      - PORT=3006
      - MONGODB_URI=mongodb://host.docker.internal:27017/study_partner
      - JWT_SECRET=your-super-secret-jwt-key-change-in-production
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - study-partner-network

  # Python AI Service - Port 8000
  ai-service:
    build:
      context: ../study-partner-ai
      dockerfile: Dockerfile
    container_name: ai-service
    restart: unless-stopped
    ports:
      - "8000:8000"
    environment:
      - MONGODB_URI=mongodb://host.docker.internal:27017/study_partner
      - GEMINI_API_KEY=AIzaSyBEwmQxqqLBIdcfESy8fwNrBfGUy-lN0nE
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - study-partner-network
    volumes:
      - ../study-partner-ai:/app
    working_dir: /app
    command: >
      bash -c "uvicorn services.api.main:app --host 0.0.0.0 --port 8000 --reload"

networks:
  study-partner-network:
    driver: bridge
